{% block content %}
{% include "header.html" %}
<br><br>
<form action="{{url_for('valveSizing', item_id=item.id, proj_id=item.project.id, page=page)}}" method="post">
        <div class="row">
                <div class="col-7 ml-3">
                        <div class="row column-headers">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <!--------------PARAMETER COLUMN-------------->
                                                <div class="col-sm-8">
                                                        <!-- <div class="row sizingtableleft"><p class="sizingp">Parameters</p></div> -->
                                                </div>
                                                <div class="col-4">
                                                        <!-- <div class="row sizingtableleft"><p class="sizingp">Units</p></div> -->
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                        <div class="col-2 colborder_bottom case{{i+1}}">
                                                                <div class="row sizingtableleft">
                                                                        <p class="case{{i+1}}"  onclick="copyPaste(this)" style="margin-right: 20px;margin-left: 5px;">
                                                                                <i class="fa-solid fa-copy clear" data-toggle="tooltip" title="Copy"></i>
                                                                        </p>
                                                                        <p class="case{{i+1}}" onclick="paste(this)">
                                                                                <i class="fa-solid fa-paste clear" data-toggle="tooltip" title="Paste"></i>
                                                                        </p>
                                                                        
                                                                </div>
                                                        </div>
                                                {% else %}
                                                        <div class="col-2 colborder_bottom case{{i+1}}">
                                                                <div class="row sizingtableleft">
                                                                        <p class="case{{i+1}}"  onclick="copyPaste(this)" style="margin-right: 20px;margin-left: 5px;">
                                                                                <i class="fa-solid fa-copy clear" data-toggle="tooltip" title="Copy"></i>
                                                                        </p>
                                                                        <p class="case{{i+1}}" onclick="paste(this)">
                                                                                <i class="fa-solid fa-paste clear" data-toggle="tooltip" title="Paste"></i>
                                                                        </p>
                                                                        
                                                                </div>
                                                        </div>
                                                {% endif %}
                                                {% endfor %}
                                        </div>
                                </div>
                        </div>
                        <div class="row column-headers">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <!--------------PARAMETER COLUMN-------------->
                                                <div class="col-sm-8 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Parameters</p></div>
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Units</p></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                        <div class="col-2 colborder_bottom case{{i+1}}">
                                                                <div class="row sizingtableleft"><p class="sizingp ml-1" >Case {{i+1}}</p>
                                                                        <p class="case{{i+1}}" onclick="clearData(this)" >
                                                                                <i class="fa-solid fa-rotate-right clear " data-toggle="tooltip" title="Clear Case {{i+1}}"></i>
                                                                        </p>
                                                                        <a href="{{url_for('itemCaseDelete', item_id=item.id, proj_id=item.project.id, case_id=cases[i].id)}}" data-id="case{{i+1}}" class="clear-case">
                                                                                <i class="fa-solid fa-close fa-1x closeicon " data-toggle="tooltip" title="Delete Case {{i+1}}"></i>
                                                                        </a>
                                                                        <!-- <p class="case{{i+1}}">
                                                                                <i class="fa-regular fa-copy" data-toggle="tooltip" title="Copy Case {{i+1}}"></fa-regular>
                                                                        </p> -->
                                                                        
                                                                </div>
                                                        </div>
                                                {% else %}
                                                        <div class="col-2 colborder_bottom case{{i+1}}">
                                                                <div class="row sizingtableleft"><p class="sizingp ml-1">Case {{i+1}}</p>
                                                                        <p class="case{{i+1}}" onclick="clearData(this)" >
                                                                                <i class="fa-solid fa-rotate-right clear " data-toggle="tooltip" title="Clear Case {{i+1}}"></i>
                                                                        </p>
                                                                        <a href="" data-id="case{{i+1}}" class="clear-case">
                                                                                <i class="fa-solid fa-close fa-1x closeicon " data-toggle="tooltip" title="Delete Case {{i+1}}"></i>
                                                                        </a>
                                                                        
                                                                </div>
                                                        </div>
                                                {% endif %}
                                                {% endfor %}
                                        </div>
                                </div>
                        </div>
                        <div class="row input-parameters">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <div class="col-sm-8 colborder_bottom">
                                                        <div class="row sizingtableleft_warning"><p class="sizingp"><strong>Warning {{item.project.flowrateUnit}}</strong></p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Flowrate</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">InletPressure</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Outlet Pressure</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Inlet Temperature</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Vapor Pressure</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Specific Gravity</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Viscosity</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Fl</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Fd</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Xt</p></div>
                                                        <div class="row sizingtableleft_warning"><p class="sizingp"><strong>Output</strong></p></div>
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtable_header"></div>
                                                        <div class="row sizingtable">
                                                                
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="flowrate">
                                                                        ">
                                                                        {% for flowrate in metadata['units_dict']['flowrate'] %}
                                                                                {% if flowrate.name == item.project.flowrateUnit %}
                                                                                <option value="{{flowrate.id}}" selected>{{flowrate.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{flowrate.name}}">{{flowrate.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="inpres">
                                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                                {% if presunit.id == item.project.pressureUnit %}
                                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{presunit.name}}">{{presunit.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs sizingunits" data-desc="outpres">
                                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                                {% if presunit.id == item.project.pressureUnit %}
                                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{presunit.name}}">{{presunit.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs">
                                                                        {% for temperature in metadata['units_dict']['temperature'] %}
                                                                                {% if temperature.id == item.project.temperatureUnit %}
                                                                                <option value="{{temperature.id}}" selected>{{temperature.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{temperature.id}}">{{temperature.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select id="#"
                                                                        class="sizingtable_inputs">
                                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                                {% if presunit.id == item.project.pressureUnit %}
                                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                                {% else %}
                                                                                <option value="{{presunit.id}}">{{presunit.name}}</option>
                                                                                {% endif %}
                                                                        {% endfor %}
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="centipose">Centipose</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                <div class="col-2 colborder_bottom case{{i+1}}">
                                                        <div class="row sizingtable_header"></div>
                                                        <div class="row sizingtable"><input type="text" name="flowrate" class="sizingtable_inputs sizingvalue_flowrate" value="{{cases[i].flowrate}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="inletPressure" class="sizingtable_inputs sizingvalue_inpres" value="{{cases[i].inletPressure}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="outletPressure" class="sizingtable_inputs sizingvalue_outpres" value="{{cases[i].outletPressure}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="inletTemp" class="sizingtable_inputs" value="{{cases[i].inletTemp}}"></div>
                                                        <div class="row sizingtable "><input type="text" name="vaporPressure" class="sizingtable_inputs" value="{{cases[i].vaporPressure}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="specificGravity" class="sizingtable_inputs sizingvalue_sg" value="{{cases[i].specificGravity}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="kinematicViscosity" class="sizingtable_inputs" value="{{cases[i].kinematicViscosity}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="fl" class="sizingtable_inputs" value="{{cases[i].fl}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="fd" class="sizingtable_inputs" value="{{cases[i].fd}}"></div>
                                                        <div class="row sizingtable"><input type="text" name="xt" class="sizingtable_inputs" value="{{cases[i].xt}}"></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                                {% else %}
                                                <div class="col-2 colborder_bottom case{{i+1}}">
                                                        <div class="row sizingtable_header"></div>
                                                        <div class="row sizingtable"><input type="text" name="flowrate" class="sizingtable_inputs sizingvalue_flowrate"></div>
                                                        <div class="row sizingtable"><input type="text" name="inletPressure" class="sizingtable_inputs sizingvalue_inpres"></div>
                                                        <div class="row sizingtable"><input type="text" name="outletPressure" class="sizingtable_inputs sizingvalue_outpres"></div>
                                                        <div class="row sizingtable"><input type="text" name="inletTemp" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable "><input type="text" name="vaporPressure" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" name="specificGravity" class="sizingtable_inputs sizingvalue_sg"></div>
                                                        <div class="row sizingtable"><input type="text" name="kinematicViscosity" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" name="fl" value="{{constants['fl']}}" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" name="fd" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" name="xt" value="{{constants['xt']}}" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                                
                                        </div>
                                </div>
                        </div>
                        
                        <div class="row output-parameters">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <div class="col-8 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Calculated CV</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Open percentage</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Choked pressure drop</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Ff</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Fp</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">FLp</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Kc</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Ar</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Re</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Valve SPL</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Valve Dia</p></div>
                                                        <div class="row sizingtableleft_warning"><p class="sizingp"> <strong>Velocity</strong></p></div>                      
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="%">%</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="dBA">dBA</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                <div class="col-2 colborder_bottom case{{i+1}}">
                                                        <div class="row sizingtable"><input type="text" class="calculatedcv_row" value="{{cases[i].calculatedCv}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].openingPercentage}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].chokedDrop}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].Ff}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].Fp}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].Flp}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].kc}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].ar}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].reNumber}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].spl}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].valveSize}}"></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                                {% else %}
                                                <div class="col-2 colborder_bottom case{{i+1}}">
                                                        <div class="row sizingtable"><input type="text" class="calculatedcv_row"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable_header"></div>
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                        </div>
                                </div>
                        </div>

                        <div class="row velocity">
                                <div class="col-4 parameters-units">
                                        <div class="row">
                                                <div class="col-8 colborder_bottom">
                                                        <div class="row sizingtableleft"><p class="sizingp">Pipe In Vel</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Pipeout Vel</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Valve Velocity</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Trim Exit vel</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Power Lvl(kw)</p></div>
                                                        <div class="row sizingtableleft"><p class="sizingp">Require Stages</p></div>
                                                </div>
                                                <div class="col-4 colborder_bottom">
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable">
                                                                <select name="" id="" class="sizingtable_inputs">
                                                                        <option value="m/s">m/s</option>
                                                                </select>
                                                        </div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                </div>
                                        </div>
                                </div>
                                <div class="col-8 input-fields">
                                        <div class="row">
                                                {% for i in case_length %}
                                                {% if cases[i] %}
                                                <div class="col-2 colborder_bottom case{{i+1}}">
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].pipeInVel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].pipeOutVel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].valveVel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].tex}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].powerLevel}}"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs" value="{{cases[i].requiredStages}}"></div>
                                                </div>
                                                {% else %}
                                                <div class="col-2 colborder_bottom case{{i+1}}">
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                        <div class="row sizingtable"><input type="text" class="sizingtable_inputs"></div>
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                        </div>
                                </div>
                        </div>
                </div>

                <div class="col-4 ml-5">
                        <div class="pipedate shadow p-3">
                                <div class="row">
                                        <div class="col-4">
                                                <label>Fluid State</label>
                                        </div>
                                        <div class="col-7">
                                                <select id="fluidState"
                                                        class="form-control-sm-sm valvesizing_select" onchange="handleSelect(this)">
                                                        {% for f_state in metadata['fluidState'] %}
                                                                {% if valve.fluidStateId == f_state.id %}
                                                                        <option value="{{url_for('updateFluidState', fs_id=f_state.id, item_id=item.id, proj_id=item.project.id)}}" selected>{{f_state.name}}</option>
                                                                {% else %}
                                                                        <option value="{{url_for('updateFluidState', fs_id=f_state.id, item_id=item.id, proj_id=item.project.id)}}">{{f_state.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                        <!-- <option>inch</option> -->
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                             <label>Solve For</label>
                                        </div>
                                        <div class="col-7">
                                                <select id="#" class="form-control-sm-sm valvesizing_select">

                                                        <option>Cv</option>
                                                        <option>Î”P</option>
                                                        <option>Flowrate</option>
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label> Fluid Properties</label> 
                                        </div>
                                        <div class="col-3 form-check form-check-inline ml-3">
                                                <input type="radio" name="fluidOption" value="Standard" class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Standard</label>
                                        </div>

                                        <div class="col-3 form-check form-check-inline">
                                                <input type="radio" name="fluidOption" value="Custom"
                                                        class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Custom</label>

                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Pipe Data</label>  
                                        </div>
                                        <div class="col-3 form-check form-check-inline ml-3">
                                                <input type="radio" value="Standard" name="pipeData"
                                                        class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Standard</label>
                                        </div>
                                        <div class="col-3 form-check form-check-inline">
                                                <input type="radio" value="Custom" name="pipeData"
                                                        class="form-control-sm-sm valvesizing_radio">
                                                <label class="ml-1 mt-2">Custom</label>

                                        </div>
                                </div>

                                <h6 class="valvesizing_heading"><b>Fluid Data</b></h6>

                                <div class="row">
                                        <div class="col-4">
                                              <label>Fluid Name</label>
                                        </div>
                                        <div class="col-7">
                                                <select class="form-control-sm-sm valvesizing_select" name="fluid_name" id="fluid_name">
                                                        {% for fluid in metadata['fluids']%}
                                                                <option value="{{fluid.id}}">{{fluid.fluidName}}</option>
                                                        {% endfor %}
                                                        
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4 pr-0">
                                               <label>Critical Pressure</label> 
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text" name="criticalPressure" required value="{{cases[0].criticalPressure}}"
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% else %}
                                                <input type="text" name="criticalPressure" required value=""
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for presunit in metadata['units_dict']['pressure'] %}
                                                                {% if presunit.id == item.project.pressureUnit %}
                                                                <option value="{{presunit.id}}" selected>{{presunit.name}}</option>
                                                                {% else %}
                                                                <option value="{{presunit.id}}">{{presunit.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>

                                <h6 class="valvesizing_heading"><b>Pipe Data</b></h6>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Inlet Pipe Size</label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text" name="inletPipeSize" required value="{{cases[0].inletPipeSize}}" class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% else %}
                                                <input type="text" name="inletPipeSize" required value="" class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for length in metadata['units_dict']['length'] %}
                                                                {% if length.name == item.project.lengthUnit %}
                                                                <option value="{{length.id}}" selected>{{length.name}}</option>
                                                                {% else %}
                                                                <option value="{{length.id}}">{{length.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>In. Pipe Sch.</label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select" name="iSch">

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                        {% if cases[0].iPipe.schedule == pipe_schedule %}
                                                                <option value="{{pipe_schedule.id}}" selected>{{pipe_schedule.name}}</option>
                                                        {% else %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        {% endif %}
                                                        {% endfor %}
                                                </select>
                                                {% else %}
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select" name="iSch">

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        
                                                        {% endfor %}
                                                </select>

                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <input type="text" class="form-control-sm-sm valvesizing_inputbox">
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4 pr-0">
                                              <label>Outlet Pipe Size</label> 
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text"
                                                        name="outletPipeSize" required value="{{cases[0].outletPipeSize}}"
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% else %}
                                                <input type="text"
                                                        name="outletPipeSize" required value=""
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% endif %}
                                                
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for length in metadata['units_dict']['length'] %}
                                                                {% if length.name == item.project.lengthUnit %}
                                                                <option value="{{length.id}}" selected>{{length.name}}</option>
                                                                {% else %}
                                                                <option value="{{length.id}}">{{length.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Out. Pipe Sch.</label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select" name="oSch">

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                        {% if cases[0].iPipe.schedule == pipe_schedule %}
                                                                <option value="{{pipe_schedule.id}}" selected>{{pipe_schedule.name}}</option>
                                                        {% else %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        {% endif %}
                                                        {% endfor %}
                                                </select>
                                                {% else %}
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select" name="oSch">

                                                        {% for pipe_schedule in metadata['units_dict']['pipe_schedule'] %}
                                                                <option value="{{pipe_schedule.id}}">{{pipe_schedule.name}}</option>
                                                        
                                                        {% endfor %}
                                                </select>

                                                {% endif %}
                                        </div>
                                        <div class="col-3">
                                                <input type="text" class="form-control-sm-sm valvesizing_inputbox">
                                        </div>
                                </div>

                                <h6 class="valvesizing_heading"><b>Valve Data</b></h6>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Valve Size</label>  
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text"
                                                name="vSize" value="{{cases[-1].valveSize}}" required
                                                class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% else %}
                                                <input type="text"
                                                name="vSize" value="" required
                                                class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% endif %}
                                                
                                        </div>
                                        <div class="col-3">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for length in metadata['units_dict']['length'] %}
                                                                {% if length.name == item.project.lengthUnit %}
                                                                <option value="{{length.id}}" selected>{{length.name}}</option>
                                                                {% else %}
                                                                <option value="{{length.id}}">{{length.name}}</option>
                                                                {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                             <label>Rated CV</label>   
                                        </div>
                                        <div class="col-4">
                                                {% if cases[0] %}
                                                <input type="text"
                                                        name="ratedCV" value="{{cases[-1].ratedCv}}" required
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% else %}
                                                <input type="text"
                                                        name="ratedCV" value="" required
                                                        class="form-control-sm-sm valvesizing_fluid_data valvesizing_inputbox">
                                                {% endif %}
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                               <label>Valve Type</label> 
                                        </div>
                                        <div class="col-4">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for valveStyle in metadata['valveStyle'] %}
                                                        {% if valveStyle.name == valve.style.name %}
                                                                <option value="{{valveStyle.id}}" selected>{{valveStyle.name}}</option>
                                                        {% else %}
                                                                <option value="{{valveStyle.id}}" disabled>{{valveStyle.name}}</option>
                                                        {% endif %}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <div class="row">
                                        <div class="col-4">
                                              <label>Trim Type</label>  
                                        </div>
                                        <div class="col-4">
                                                <select id="#"
                                                        class="form-control-sm-sm valvesizing_select">
                                                        {% for trimtype in metadata['trimtype'] %}
                                                                {%if trimtype.valveStyleId == metadata['globeStyleId'] or trimtype.valveStyleId == metadata['butterflyStyleId'] %}
                                                                        {% if trimtype.name == valve.trimType__.name %}
                                                                                <option value="{{trimtype.id}}" selected>{{trimtype.name}}</option>
                                                                        {% else %}
                                                                                <option value="{{trimtype.id}}" disabled>{{trimtype.name}}</option>
                                                                        {% endif %}
                                                                {%endif%}
                                                        {% endfor %}
                                                </select>
                                        </div>
                                </div>
                                <button type="submit" class="btn btn-info btn-sm  mt-2">Calculate</button>
                                <a href="{{url_for('selectValve', proj_id=item.project.id, item_id=item.id)}}">
                                        <button type="button" class="btn btn-success btn-sm valve_btn2 mt-2">Select Valve</button></a>
                        </div>
                </div>

        </div>
</form>
                


<script type="text/javascript">


        $(document).ready(function(){
                var prev_unit;
                $('.sizingunits').on('focus', function(){
                        prev_unit = $(this).val();
                });

                $('.sizingunits').on('change', function(){

                        var final_unit = $(this).val();
                        console.log(prev_unit,final_unit);
                        var params = $(this).data('desc');
                        var param_values = []
                        var specificGravity = []

                        $('.sizingvalue_' + params).each(function() {
                                param_values.push(this.value);
                        });
                        $('.sizingvalue_sg').each(function (){
                                specificGravity.push(this.value);
                        })

                        $.ajax({
                                type: "GET",
                                url: "/unit_change",
                                data: {
                                prev_unit: prev_unit,
                                final_unit: final_unit,
                                params: params,     
                                param_values: JSON.stringify(param_values),
                                specific_gravity: JSON.stringify(specificGravity)
                                },
                                success: function(response) {
                                        ans_values = $.parseJSON(response)
                                        console.log('ans',ans_values)
                                        $('.sizingvalue_' + params).each(function(index) {
                                                $(this).val(ans_values[index]);
                                        });
                                },
                                error: function(xhr, status, error) {
                                console.error("Error:", error);
                                }
                        });

                        prev_unit = final_unit;
                });
        });

                

                        // $('.sizingunits').on('change', function() { 
                        //       var description = $(this).data('desc');
                        //       var unit_value = $(this).val();
                        //       var desc_values = []
                        //       var specificGravity = []
                        //       var ans_values = []
                        //       $('.sizingvalue_sg').each(function (){
                        //         specificGravity.push(this.value);
                        //       })
                        //       $('.sizingvalue_' + description).each(function() {
                        //                 desc_values.push(this.value);
                        //         });
                        //       console.log('ffff',specificGravity);
                        //       $.ajax({
                        //         type: "GET",
                        //         url: "/unit_change",
                        //         data: {
                        //         desc: description,
                        //         desc_values: JSON.stringify(desc_values),
                        //         unit_value: unit_value,
                        //         specific_gravity: JSON.stringify(specificGravity)
                        //         },
                        //         success: function(response) {
                        //                 ans_values = $.parseJSON(response)
                        //                 $('.sizingvalue_' + description).each(function(index) {
                        //                         $(this).val(ans_values[index]);
                        //                 });
                        //         },
                        //         error: function(xhr, status, error) {
                        //         console.error("Error:", error);
                        //         }
                        // });
                        // })




                        var copiedOuptput = {value: NaN}
                        function clearData(obj) {
                                var class_hide = "." + obj.className;
                                let res = $(class_hide + ' input').map(function(){
                                        return $(this).val('');
                                });
                        };

                        function handleSelect(elm) {
                                // alert('js working for fstate')
                                window.location = elm.value
                        };

                        function copyPaste(obj) {
                                var class_hide = "." + obj.className;
                                let res = $(class_hide + ' input').map(function(){
                                        return $(this).val();
                                }).get();
                                console.log(res);
                                copiedOuptput.value = res
                                alert('Values Copied from ' + obj.className)

                        };

                        function paste(obj) {
                                var class_hide = "." + obj.className;
                                let res2 = $(class_hide + ' input');
                                copiedOuptput.value.map((value, index) => {
                                        res2[index].value = value;
                                }); 
                        };
                </script>
                <script>
                        
                        window.onload = function () {
                                var fluid_dict = JSON.parse({{metadata['fluids_dict']|tojson}});
                                var case_len = "{{total_length}}";
                                var fluidName_ = document.getElementById("fluid_name");
                                fluidName_.onchange = function () {
                                        var selected_fluid = $("#fluid_name :selected").text()
                                        var fluid_option = $("input[name='fluidOption']:checked").val()
                                        alert(fluid_option)
                                        var fluid_name_ = $("#fluid_name :selected").text();
                                        console.log(fluid_dict[selected_fluid].viscosity);
                                        if (fluid_option == 'Standard') {
                                                $("input[name='kinematicViscosity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].viscosity;
                                                        };
                                                });
                                                $("input[name='vaporPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].vaporPressure;
                                                        };
                                                });
                                                $("input[name='specificGravity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].specificGravity;
                                                        };
                                                });
                                                $("input[name='criticalPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = fluid_dict[selected_fluid].criticalPressure;
                                                        };
                                                });
                                                alert(fluid_name_);

                                        } else {
                                                $("input[name='kinematicViscosity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        };
                                                });
                                                
                                                $("input[name='vaporPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        };
                                                });
                                                $("input[name='specificGravity']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        }
                                                });
                                                $("input[name='criticalPressure']").each(function(index) {
                                                        if (index > Number(case_len)-1) {
                                                                this.value = "";
                                                        }
                                                });
                                        };
                                };
                        };
                </script>

{% include "footer.html" %}
{% endblock %}